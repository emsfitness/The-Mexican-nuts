<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>محمصة المكسيكي</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<style>
    :root {
      --primary-color: #b87333;  /* نحاسي */
      --secondary-color: #d4af37;  /* ذهبي */
      --accent-color: #ffd700;  /* ذهبي فاتح */
      --text-color: #e0e0e0;    /* رمادي فاتح */
      --light-bg: #121212;      /* أسود داكن */
      --card-bg: #1e1e1e;       /* أسود */
      --gradient-bg: linear-gradient(135deg, #b87333 0%, #1e1e1e 100%);
      --border-radius: 16px;
      --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s ease-in-out;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      background: var(--light-bg);
      color: var(--text-color);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    header {
      background-color: rgba(30, 30, 30, 0.95);
      padding: 12px 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 999;
      width: 100%;
      gap: 10px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 200px;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .welcome {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-color);
      text-align: center;
      animation: glow 2s ease-in-out infinite alternate;
      flex: 1;
      padding: 0 10px;
    }
    
    @keyframes glow {
      from { 
        text-shadow: 0 0 5px rgba(184, 115, 51, 0.7), 
                     0 0 10px rgba(212, 175, 55, 0.5); 
      }
      to { 
        text-shadow: 0 0 15px rgba(184, 115, 51, 0.9), 
                     0 0 25px rgba(212, 175, 55, 0.7); 
      }
    }
    
    .login-form {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    
    .login-form.active {
      display: block;
    }
    
    .login-form input {
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius);
      border: 1px solid #444;
      font-family: 'Cairo';
      font-size: 0.95rem;
      margin: 8px 0;
      background: #2a2a2a;
      color: var(--text-color);
    }
    
    .login-form button {
      transition: var(--transition);
      width: 100%;
      padding: 10px;
      font-size: 0.95rem;
      background: var(--primary-color);
      color: #000;
    }
    
    .login-icon {
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--primary-color);
      transition: transform 0.3s;
    }
    
    .login-icon:hover {
      transform: scale(1.1);
    }
    
    h1, h2, h3 {
      color: var(--primary-color);
      margin: 1rem 0;
    }
    
    h1 {
      font-size: 1.8rem;
      text-align: center;
      padding: 0 16px;
    }
    
    h2 {
      font-size: 1.5rem;
      text-align: center;
    }
    
    h3 {
      font-size: 1.2rem;
    }
    
    #products, .admin-products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 16px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      animation: fadeInUp 0.6s ease-in-out;
      border: 1px solid #333;
      padding: 16px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: var(--border-radius);
      margin-bottom: 12px;
    }
    
    .order-form, .edit-form {
      display: none;
      margin-top: 12px;
      background: #2a2a2a;
      padding: 12px;
      border-radius: var(--border-radius);
    }
    
    .order-form {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .order-form-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 999;
    }
    
    .order-form-overlay.active {
      display: block;
    }
    
    input, textarea, button {
      transition: var(--transition);
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius);
      border: 1px solid #444;
      font-family: 'Cairo';
      font-size: 0.95rem;
      margin: 6px 0;
      background: #2a2a2a;
      color: var(--text-color);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    button {
      transition: var(--transition);
      background-color: var(--primary-color);
      color: #000;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s, transform 0.2s;
      margin: 8px 0;
    }
    
    button:hover {
      transform: scale(1.05);
      background: var(--secondary-color); 
      color: #000;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    /* التعديلات الخاصة بالتفاصيل */
    .product-details {
      max-height: 80px;
      overflow: hidden;
      position: relative;
      margin: 8px 0;
    }
    
    .product-details.expanded {
      max-height: none;
      overflow: visible;
    }
    
    .show-more {
      color: var(--primary-color);
      cursor: pointer;
      text-align: left;
      margin: 5px 0;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    /* لوحة التحكم */
    .admin-section {
      display: none;
      padding: 16px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .admin-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #444;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
    
    .admin-tab {
      padding: 10px 20px;
      cursor: pointer;
      background: #2a2a2a;
      margin-left: 5px;
      border-radius: 8px 8px 0 0;
      font-size: 0.95rem;
    }
    
    .admin-tab.active {
      background: var(--primary-color);
      color: #000;
    }
    
    .admin-tab-content {
      display: none;
      padding: 10px 0;
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 0.9rem;
    }
    
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    
    th {
      background-color: #2a2a2a;
    }
    
    .main-store {
      display: block;
    }
    
    .admin-logged-in .main-store {
      display: none;
    }
    
    .top-buttons {
      display: flex;
      gap: 10px;
      position: relative;
    }
    
    .top-buttons button {
      transition: var(--transition);
      width: auto;
      padding: 8px 16px;
      font-size: 0.9rem;
      z-index: 1;
    }
    
    /* شريط البحث */
    .search-container {
      display: flex;
      margin: 16px auto;
      max-width: 600px;
      padding: 0 16px;
    }
    
    .search-container input {
      border-radius: var(--border-radius) 0 0 var(--border-radius);
      margin: 0;
    }
    
    .search-container button {
      transition: var(--transition);
      width: auto;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
      padding: 0 16px;
    }
    
    /* قسم طلب الشراء الجديد */
    .order-section {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      background: #2a2a2a;
      border-radius: var(--border-radius);
      margin-top: 10px;
    }
    
    .order-section.expanded {
      max-height: 500px;
      padding: 12px;
      margin-top: 10px;
    }
    
    .order-section input {
      margin-bottom: 8px;
    }
    
    .order-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .order-buttons button {
      transition: var(--transition);
      flex: 1;
      padding: 8px;
    }
    
    .order-buttons button.cancel {
      background: #6c757d;
    }
    
    /* تعديلات للهواتف الصغيرة */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .header-left, .header-right {
        flex-direction: column;
        gap: 8px;
      }
      
      .welcome {
        font-size: 1.3rem;
        margin: 5px 0;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      #products, .admin-products {
        grid-template-columns: 1fr;
        padding: 10px;
      }
      
      .card {
        animation: fadeInUp 0.6s ease-in-out;
        width: 100%;
      }
      
      .admin-tab {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      
      .top-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .top-buttons button {
        transition: var(--transition);
        width: auto;
        padding: 8px 12px;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .search-container input {
        border-radius: var(--border-radius);
        margin-bottom: 5px;
      }
      
      .search-container button {
        transition: var(--transition);
        border-radius: var(--border-radius);
        width: 100%;
      }
    }
    
    /* تعديلات للأجهزة اللوحية */
    @media (min-width: 481px) and (max-width: 768px) {
      #products, .admin-products {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  
@keyframes fadeInUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.search-container {
  display: flex;
  flex-direction: row-reverse;
  align-items: center;
  justify-content: space-between;
}
.search-icon-button {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--primary-color);
  font-size: 1.2rem;
  padding: 0 12px;
}
.search-icon-button:hover {
  color: var(--secondary-color);
}
    

/* شريط إعلان متحرك */
.marquee {
  background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
  color: #000;
  font-weight: bold;
  padding: 10px;
  overflow: hidden;
  position: sticky;
  top: 0;
  z-index: 1000;
}
.marquee span {
  display: inline-block;
  white-space: nowrap;
  animation: marquee 15s linear infinite;
}
@keyframes marquee {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

.copyright {
  text-align: center;
  padding: 8px;
  background: #1e1e1e;
  color: var(--primary-color);
  font-size: 0.8rem;
  border-top: 1px solid #333;
}

/* مؤثرات الخطوط والعناوين */
h1 {
  text-shadow: 0 0 8px rgba(184, 115, 51, 0.7), 0 0 12px rgba(212, 175, 55, 0.5);
}
.gradient-text {
  background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: typing 5s infinite alternate;
}
@keyframes typing {
  from { letter-spacing: 2px; }
  to { letter-spacing: 8px; }
}
h2, h3 {
  transition: transform 0.3s;
}
h2:hover, h3:hover {
  transform: scale(1.05) rotate(-1deg);
}

/* بطاقات القوائم */
.card {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeUp 0.8s forwards;
}
.card:hover {
  transform: rotate(1deg) scale(1.02);
}
.card:focus-within {
  transform: scale(1.05);
}
@keyframes fadeUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* أزرار */
button {
  animation: pulse 2s infinite;
  transition: all 0.3s ease;
}
button:active {
  transform: translateY(2px) scale(0.98);
}
button:hover {
  background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(184, 115, 51, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(184, 115, 51, 0); }
  100% { box-shadow: 0 0 0 0 rgba(184, 115, 51, 0); }
}

/* صور */
.card img {
  filter: blur(4px);
  animation: sharpen 1.2s forwards;
  border: 3px dashed var(--primary-color);
  box-shadow: 0 0 5px var(--primary-color);
}
@keyframes sharpen {
  to {
    filter: blur(0);
  }
}

/* أزرار الإجراءات في الجداول */
.action-buttons {
  display: flex;
  gap: 5px;
  justify-content: center;
}

.action-buttons button {
  padding: 5px 10px;
  font-size: 0.8rem;
  margin: 0;
}

.complete-btn {
  background-color: #28a745;
}

.cancel-btn {
  background-color: #dc3545;
}

.clear-reports-btn {
  background-color: #dc3545;
  margin-bottom: 20px;
}

/* قسم التقارير */
.report-summary {
  background-color: #2a2a2a;
  padding: 15px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  border: 1px solid #444;
}

.report-summary h3 {
  color: var(--primary-color);
  margin-bottom: 10px;
}

.report-summary p {
  margin: 5px 0;
  font-size: 1.1rem;
}

.report-summary .total {
  font-weight: bold;
  color: var(--primary-color);
  font-size: 1.2rem;
  margin-top: 10px;
}

/* أقسام من نحن وتواصل معنا */
.about-card, .contact-form-container {
  position: absolute;
  top: 100%;
  right: 0;
  width: 300px;
  background: var(--card-bg);
  border-radius: 0 0 var(--border-radius) var(--border-radius);
  box-shadow: var(--box-shadow);
  overflow: hidden;
  max-height: 0;
  transition: max-height 0.5s ease-out;
  z-index: 100;
}

.about-card.expanded, .contact-form-container.expanded {
  max-height: 600px;
  padding: 15px;
  border: 1px solid #444;
}

.about-content {
  padding: 10px;
}

.about-card h3, .contact-form-container h3 {
  margin-top: 0;
  color: var(--primary-color);
  text-align: center;
}

.contact-form {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.contact-form button {
  margin-top: 10px;
}

.close-btn {
  position: absolute;
  top: 5px;
  left: 5px;
  background: transparent;
  border: none;
  color: var(--text-color);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 5px;
}
</style>
</head>
<body>

<div class="marquee"><span>✨ عروض اليوم: خصم 20% على جميع المنتجات! ✨ اطلب الآن قبل انتهاء الكمية ✨</span></div>
<div class="copyright">جميع حقوق التصميم محفوظة لـ SFW للتسويق الذكي ت: 01019899098</div>
<header>
<div class="header-left">
<div class="top-buttons">
<button id="aboutBtn">من نحن</button>
<div class="about-card" id="aboutCard">
  <button class="close-btn" onclick="closeAboutCard()">&times;</button>
  <h3>محمصة المكسيكي</h3>
  <div class="about-content">
    <p>تحميص يومي للبن والمكسرات بأعلى جودة وأفضل سعر</p>
    <p><strong>فروعنا:</strong></p>
    <ul style="padding-right: 15px;">
      <li>الفرع الرئيسي: السويس - 24 أكتوبر ش ناصر داخل ماركت ثمرة التوحيد تليفون 01141278024 </li>
      <li>1- الشيخ زايد: بيفرلي هيلز - المختار ماركت</li>
      <li>2- دهب شرم الشيخ: أمام ماركت غزال</li>
      <li>3- القاهرة شبرا الخيمة: بيجام أمام وليد للإلكترونيات</li>
    </ul>
  </div>
</div>

<button id="contactBtn">تواصل معنا</button>
<div class="contact-form-container" id="contactFormContainer">
  <button class="close-btn" onclick="closeContactForm()">&times;</button>
  <h3>تواصل معنا</h3>
  <div class="contact-form">
    <input id="contactName" placeholder="اسمك بالكامل" type="text" required>
    <input id="contactPhone" placeholder="رقم الهاتف" type="tel" required>
    <textarea id="contactMessage" placeholder="رسالتك" required></textarea>
    <button onclick="sendContactMessage()">إرسال الرسالة</button>
  </div>
</div>
</div>
<div class="welcome">( مرحباً بكم مع محمصة المكسيكي! قزقز المتعة! )</div>
</div>
<div class="header-right">
<i class="fas fa-sign-in-alt login-icon" onclick="toggleLoginForm()"></i>
</div>
<div class="login-form" id="loginForm">
<h2>تسجيل دخول الأدمن</h2>
<input id="adminUser" placeholder="اسم المستخدم" type="text"/>
<input id="adminPass" placeholder="كلمة المرور" type="password"/>
<button onclick="loginAdmin()">دخول</button>
<button onclick="toggleLoginForm()" style="background: #6c757d;">إلغاء</button>
</div>
</header>
<div class="main-store">
<h1>معروضات المتجر</h1>
<!-- شريط البحث -->
<div class="search-container" style="justify-content: flex-end;"><input id="searchInput" placeholder="ابحث عن منتج..." style="flex: 1; max-width: 100%;" type="text"/><button class="search-icon-button" onclick="searchProducts()"><i class="fas fa-search"></i></button></div>
<div id="products"></div>
</div>
<div class="admin-section">
<button onclick="logoutAdmin()">خروج الأدمن</button>
<div class="admin-tabs">
<div class="admin-tab active" onclick="switchAdminTab('products-tab')">معروضات المتجر</div>
<div class="admin-tab" onclick="switchAdminTab('add-tab')">إضافة منتج</div>
<div class="admin-tab" onclick="switchAdminTab('orders-tab')">طلبات الشراء</div>
<div class="admin-tab" onclick="switchAdminTab('reports-tab')">تقارير المبيعات</div>
<div class="admin-tab" onclick="switchAdminTab('messages-tab')">رسائل العملاء</div>
</div>
<div class="admin-tab-content active" id="products-tab">
<h2>إدارة معروضات المتجر</h2>
<div class="admin-products" id="adminProducts"></div>
</div>
<div class="admin-tab-content" id="add-tab">
<h2>إضافة منتج جديد</h2>
<div class="admin-panel">
<input id="productName" placeholder="اسم المنتج" type="text"/>
<input id="productPrice" placeholder="السعر" type="text"/>
<textarea id="productDetails" placeholder="التفاصيل"></textarea>
<input accept="image/*" id="productImageFile" type="file"/>
<button onclick="addProduct()">إضافة منتج</button>
</div>
</div>
<div class="admin-tab-content" id="orders-tab">
<h2>طلبات الشراء</h2>
<table id="ordersTable">
<tr><th>المنتج</th><th>الكمية</th><th>العميل</th><th>الهاتف</th><th>العنوان</th><th>إجراء</th></tr>
</table>
</div>
<div class="admin-tab-content" id="reports-tab">
<h2>تقارير المبيعات</h2>
<button class="clear-reports-btn" onclick="clearReports()">مسح التقارير</button>
<div class="report-summary" id="reportSummary"></div>
<table id="reportsTable">
<tr><th>المنتج</th><th>الكمية</th><th>السعر</th><th>المبلغ</th><th>التاريخ</th></tr>
</table>
</div>
<div class="admin-tab-content" id="messages-tab">
<h2>رسائل العملاء</h2>
<table id="messagesTable">
<tr><th>الاسم</th><th>الهاتف</th><th>الرسالة</th><th>التاريخ</th><th>إجراء</th></tr>
</table>
</div>
</div>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIlw1XSqdtZL18vQE7YJibO-k5T8oI3UM",
      authDomain: "nuts-cafe6.firebaseapp.com",
      projectId: "nuts-cafe6",
      storageBucket: "nuts-cafe6.appspot.com",
      messagingSenderId: "498764909089",
      appId: "1:498764909089:web:7a4fd323a7791834257160",
      measurementId: "G-EQFJR46ST1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // متغير لتخزين جميع المنتجات للبحث
    let allProducts = [];

    // تعريف متغيرات الأزرار والأقسام
    const aboutBtn = document.getElementById('aboutBtn');
    const contactBtn = document.getElementById('contactBtn');
    const aboutCard = document.getElementById('aboutCard');
    const contactFormContainer = document.getElementById('contactFormContainer');

    // إضافة event listeners للأزرار
    aboutBtn.addEventListener('click', toggleAboutCard);
    contactBtn.addEventListener('click', toggleContactForm);

    function toggleAboutCard() {
      // إغلاق نموذج التواصل إذا كان مفتوحًا
      if (contactFormContainer.classList.contains('expanded')) {
        contactFormContainer.classList.remove('expanded');
      }
      
      // تبديل بطاقة "من نحن"
      aboutCard.classList.toggle('expanded');
    }

    function closeAboutCard() {
      aboutCard.classList.remove('expanded');
    }

    function toggleContactForm() {
      // إغلاق بطاقة "من نحن" إذا كانت مفتوحة
      if (aboutCard.classList.contains('expanded')) {
        aboutCard.classList.remove('expanded');
      }
      
      // تبديل نموذج التواصل
      contactFormContainer.classList.toggle('expanded');
    }

    function closeContactForm() {
      contactFormContainer.classList.remove('expanded');
    }

    function renderProducts(products = null) {
      const productsToRender = products || allProducts;
      const container = document.getElementById('products');
      container.innerHTML = '';
      
      productsToRender.forEach(product => {
        const card = document.createElement('div');
        card.className = 'card';
        
        let showMoreBtn = '';
        if (product.details.length > 150) {
          showMoreBtn = '<div class="show-more" onclick="toggleDetails(this)">المزيد ▼</div>';
        }
        
        card.innerHTML = `
          <img src="${product.image}" alt="صورة المنتج">
          <h3>${product.name}</h3>
          <div class="product-details">${product.details}</div>
          ${showMoreBtn}
          <p><strong>${product.price} جنيه</strong></p>
          <button onclick="toggleOrderSection('${product.id}')">طلب شراء</button>
          <div class="order-section" id="order-section-${product.id}">
            
    <select id="qty-${product.id}">
      <option value="نصف ثمن كيلو">نصف ثمن كيلو</option>
      <option value="ثمن كيلو">ثمن كيلو</option>
      <option value="ربع كيلو">ربع كيلو</option>
      <option value="نصف كيلو">نصف كيلو</option>
      <option value="1 كيلو">1 كيلو</option>
      <option value="2 كيلو">2 كيلو</option>
      <option value="5 كيلو">5 كيلو</option>
    </select>
    
            <input type="text" placeholder="اسمك" id="name-${product.id}">
            <input type="tel" placeholder="رقم الهاتف" id="phone-${product.id}">
            <input type="text" placeholder="العنوان" id="address-${product.id}">
            <div class="order-buttons">
              <button onclick="submitOrder('${product.id}')">حفظ الطلب</button>
              <button class="cancel" onclick="toggleOrderSection('${product.id}')">إلغاء</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function renderAdminProducts() {
      db.ref('products').on('value', snapshot => {
        const container = document.getElementById('adminProducts');
        container.innerHTML = '';
        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;
          const card = document.createElement('div');
          card.className = 'card';
          
          let showMoreBtn = '';
          if (data.details.length > 100) {
            showMoreBtn = '<div class="show-more" onclick="toggleDetails(this)">المزيد ▼</div>';
          }
          
          card.innerHTML = `
            <img src="${data.image}" alt="صورة المنتج">
            <h3>${data.name}</h3>
            <div class="product-details">${data.details}</div>
            ${showMoreBtn}
            <p><strong>${data.price} جنيه</strong></p>
            <button onclick="showEditForm('${key}')">تعديل</button>
            <button onclick="deleteProduct('${key}')">حذف</button>
            <div class="edit-form" id="edit-form-${key}">
              <input type="text" id="edit-name-${key}" value="${data.name}" placeholder="اسم المنتج">
              <input type="text" id="edit-price-${key}" value="${data.price}" placeholder="السعر">
              <textarea id="edit-details-${key}" placeholder="التفاصيل">${data.details}</textarea>
              <button onclick="updateProduct('${key}')">حفظ التعديلات</button>
              <button onclick="hideEditForm('${key}')">إلغاء</button>
            </div>
          `;
          container.appendChild(card);
        });
      });
    }

    function toggleDetails(element) {
      const detailsDiv = element.previousElementSibling;
      detailsDiv.classList.toggle('expanded');
      element.textContent = detailsDiv.classList.contains('expanded') ? 'إخفاء ▲' : 'المزيد ▼';
    }

    function toggleOrderSection(productId) {
      const orderSection = document.getElementById(`order-section-${productId}`);
      orderSection.classList.toggle('expanded');
    }

    function submitOrder(productId) {
      const qty = document.getElementById(`qty-${productId}`).value;
      const name = document.getElementById(`name-${productId}`).value;
      const phone = document.getElementById(`phone-${productId}`).value;
      const address = document.getElementById(`address-${productId}`).value;
      
      if (!qty || parseInt(qty) < 1) return alert('الكمية يجب أن تكون رقم موجب');
      if (!name) return alert('يرجى إدخال اسمك');
      if (!phone) return alert('يرجى إدخال رقم الهاتف');
      if (!address) return alert('يرجى إدخال العنوان');
      
      // الحصول على اسم المنتج من البيانات المحلية
      const product = allProducts.find(p => p.id === productId);
      if (!product) return alert('المنتج غير موجود');
      
      db.ref('orders').push({ 
        productName: product.name, 
        qty, 
        name, 
        phone, 
        address,
        productPrice: product.price,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      })
      .then(() => {
        alert('تم إرسال الطلب بنجاح');
        toggleOrderSection(productId);
        // مسح حقول النموذج
        document.getElementById(`qty-${productId}`).value = '1';
        document.getElementById(`name-${productId}`).value = '';
        document.getElementById(`phone-${productId}`).value = '';
        document.getElementById(`address-${productId}`).value = '';
      })
      .catch(error => {
        console.error('Error saving order:', error);
        alert('حدث خطأ أثناء حفظ الطلب، يرجى المحاولة مرة أخرى');
      });
    }

    function toggleLoginForm() {
      document.getElementById('loginForm').classList.toggle('active');
    }

    function loginAdmin() {
      const user = document.getElementById('adminUser').value;
      const pass = document.getElementById('adminPass').value;
      if (user === 'admin' && pass === '1234') {
        document.querySelector('.admin-section').style.display = 'block';
        document.body.classList.add('admin-logged-in');
        toggleLoginForm();
        loadOrders();
        loadMessages();
        loadReports();
        renderAdminProducts();
      } else {
        alert('بيانات الدخول غير صحيحة');
      }
    }

    function logoutAdmin() {
      document.querySelector('.admin-section').style.display = 'none';
      document.body.classList.remove('admin-logged-in');
    }

    function switchAdminTab(tabId) {
      document.querySelectorAll('.admin-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.admin-tab[onclick="switchAdminTab('${tabId}')"]`).classList.add('active');
      
      if (tabId === 'orders-tab') {
        loadOrders();
      } else if (tabId === 'products-tab') {
        renderAdminProducts();
      } else if (tabId === 'messages-tab') {
        loadMessages();
      } else if (tabId === 'reports-tab') {
        loadReports();
      }
    }

    function addProduct() {
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const details = document.getElementById('productDetails').value;
      const fileInput = document.getElementById('productImageFile');
      
      if (!name || !price || !details) {
        return alert('يرجى ملء جميع الحقول');
      }
      
      if (!fileInput.files[0]) {
        return alert('يرجى اختيار صورة للمنتج');
      }
      
      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        db.ref('products').push({ 
          name, 
          price, 
          details, 
          image: imageData,
          createdAt: firebase.database.ServerValue.TIMESTAMP
        });
        
        alert('تمت إضافة المنتج بنجاح');
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productDetails').value = '';
        fileInput.value = '';
        
        switchAdminTab('products-tab');
      };
      reader.readAsDataURL(fileInput.files[0]);
    }

    function showEditForm(productId) {
      document.getElementById(`edit-form-${productId}`).style.display = 'block';
    }

    function hideEditForm(productId) {
      document.getElementById(`edit-form-${productId}`).style.display = 'none';
    }

    function updateProduct(productId) {
      const name = document.getElementById(`edit-name-${productId}`).value;
      const price = document.getElementById(`edit-price-${productId}`).value;
      const details = document.getElementById(`edit-details-${productId}`).value;
      
      if (!name || !price || !details) {
        return alert('يرجى ملء جميع الحقول');
      }
      
      db.ref('products/' + productId).update({
        name: name,
        price: price,
        details: details,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
      });
      
      alert('تم تحديث المنتج بنجاح');
      hideEditForm(productId);
    }

    function deleteProduct(productId) {
      if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
        db.ref('products/' + productId).remove();
        alert('تم حذف المنتج بنجاح');
      }
    }

    function loadOrders() {
      db.ref('orders').orderByChild('timestamp').on('value', snapshot => {
        const table = document.getElementById('ordersTable');
        table.innerHTML = '<tr><th>المنتج</th><th>الكمية</th><th>العميل</th><th>الهاتف</th><th>العنوان</th><th>إجراء</th></tr>';
        
        const orders = [];
        snapshot.forEach(child => {
          orders.push({
            key: child.key,
            ...child.val()
          });
        });
        
        // عرض الطلبات من الأحدث إلى الأقدم
        orders.reverse().forEach(order => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${order.productName}</td>
            <td>${order.qty}</td>
            <td>${order.name}</td>
            <td>${order.phone}</td>
            <td>${order.address}</td>
            <td>
              <div class="action-buttons">
                <button class="complete-btn" onclick="completeOrder('${order.key}', '${order.productName}', '${order.qty}', '${order.productPrice}')">تم التنفيذ</button>
                <button class="cancel-btn" onclick="cancelOrder('${order.key}')">إلغاء</button>
              </div>
            </td>
          `;
          table.appendChild(row);
        });
      });
    }

    function completeOrder(orderId, productName, qty, productPrice) {
      if (confirm('هل تم تنفيذ هذا الطلب؟')) {
        // حساب المبلغ بناءً على الكمية والسعر
        let amount = 0;
        const price = parseFloat(productPrice) || 0;
        
        if (qty.includes('نصف ثمن كيلو')) amount = price * 0.0625;
        else if (qty.includes('ثمن كيلو')) amount = price * 0.125;
        else if (qty.includes('ربع كيلو')) amount = price * 0.25;
        else if (qty.includes('نصف كيلو')) amount = price * 0.5;
        else if (qty.includes('1 كيلو')) amount = price * 1;
        else if (qty.includes('2 كيلو')) amount = price * 2;
        else if (qty.includes('5 كيلو')) amount = price * 5;
        
        // حفظ الطلب في التقارير
        db.ref('reports').push({
          productName: productName,
          qty: qty,
          price: productPrice + ' جنيه',
          amount: amount + ' جنيه',
          date: new Date().toLocaleDateString('ar-EG'),
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        
        // حذف الطلب من قائمة الطلبات
        db.ref('orders/' + orderId).remove();
      }
    }

    function cancelOrder(orderId) {
      if (confirm('هل تريد إلغاء هذا الطلب؟')) {
        db.ref('orders/' + orderId).remove();
      }
    }
    
    function loadReports() {
      db.ref('reports').orderByChild('timestamp').on('value', snapshot => {
        const table = document.getElementById('reportsTable');
        const summaryDiv = document.getElementById('reportSummary');
        table.innerHTML = '<tr><th>المنتج</th><th>الكمية</th><th>السعر</th><th>المبلغ</th><th>التاريخ</th></tr>';
        
        const reports = [];
        let totalAmount = 0;
        snapshot.forEach(child => {
          reports.push({
            key: child.key,
            ...child.val()
          });
          
          // حساب المبلغ الإجمالي
          const amountStr = child.val().amount;
          const amount = parseFloat(amountStr) || 0;
          totalAmount += amount;
        });
        
        // عرض ملخص المبيعات
        summaryDiv.innerHTML = `
          <h3>ملخص المبيعات</h3>
          <p>إجمالي عدد الطلبات: <strong>${reports.length}</strong></p>
          <p>إجمالي المبيعات: <strong>${totalAmount.toFixed(2)} جنيه</strong></p>
          <p class="total">صافي المبلغ: <strong>${totalAmount.toFixed(2)} جنيه</strong></p>
        `;
        
        // عرض التقارير من الأحدث إلى الأقدم
        reports.reverse().forEach(report => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${report.productName}</td>
            <td>${report.qty}</td>
            <td>${report.price}</td>
            <td>${report.amount}</td>
            <td>${report.date}</td>
          `;
          table.appendChild(row);
        });
      });
    }
    
    function clearReports() {
      if (confirm('هل تريد مسح جميع التقارير؟ لا يمكن التراجع عن هذا الإجراء.')) {
        db.ref('reports').remove()
          .then(() => {
            alert('تم مسح جميع التقارير بنجاح');
            loadReports();
          })
          .catch(error => {
            console.error('Error clearing reports:', error);
            alert('حدث خطأ أثناء محاولة مسح التقارير');
          });
      }
    }
    
    function sendContactMessage() {
      const name = document.getElementById('contactName').value;
      const phone = document.getElementById('contactPhone').value;
      const message = document.getElementById('contactMessage').value;
      
      if (!name || !phone || !message) {
        return alert('يرجى ملء جميع الحقول المطلوبة');
      }
      
      if (!/^01[0-2|5]{1}[0-9]{8}$/.test(phone)) {
        return alert('يرجى إدخال رقم هاتف صحيح (11 رقماً)');
      }
      
      db.ref('messages').push({
        name: name,
        phone: phone,
        message: message,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      })
      .then(() => {
        alert('تم إرسال رسالتك بنجاح، شكراً لتواصلك معنا!');
        document.getElementById('contactName').value = '';
        document.getElementById('contactPhone').value = '';
        document.getElementById('contactMessage').value = '';
        closeContactForm();
      })
      .catch(error => {
        console.error('Error sending message:', error);
        alert('حدث خطأ أثناء إرسال الرسالة، يرجى المحاولة مرة أخرى');
      });
    }
    
    function loadMessages() {
      db.ref('messages').orderByChild('timestamp').on('value', snapshot => {
        const table = document.getElementById('messagesTable');
        table.innerHTML = '<tr><th>الاسم</th><th>الهاتف</th><th>الرسالة</th><th>التاريخ</th><th>إجراء</th></tr>';
        
        const messages = [];
        snapshot.forEach(child => {
          messages.push({
            key: child.key,
            ...child.val()
          });
        });
        
        // عرض الرسائل من الأحدث إلى الأقدم
        messages.reverse().forEach(msg => {
          const date = new Date(msg.timestamp);
          const dateStr = date.toLocaleDateString('ar-EG') + ' ' + date.toLocaleTimeString('ar-EG');
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${msg.name}</td>
            <td>${msg.phone}</td>
            <td>${msg.message}</td>
            <td>${dateStr}</td>
            <td><button onclick="deleteMessage('${msg.key}')">حذف</button></td>
          `;
          table.appendChild(row);
        });
      });
    }
    
    function deleteMessage(messageId) {
      if (confirm('هل تريد حذف هذه الرسالة؟')) {
        db.ref('messages/' + messageId).remove();
      }
    }
    
    // وظيفة البحث عن المنتجات
    function searchProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if (!searchTerm) {
        renderProducts(allProducts);
        return;
      }
      
      const filteredProducts = allProducts.filter(product => 
        product.name.toLowerCase().includes(searchTerm) || 
        product.details.toLowerCase().includes(searchTerm) ||
        product.price.toLowerCase().includes(searchTerm)
      );
      
      renderProducts(filteredProducts);
    }
    
    // تحميل المنتجات عند بدء التشغيل
    document.addEventListener('DOMContentLoaded', () => {
      db.ref('products').on('value', snapshot => {
        allProducts = [];
        snapshot.forEach(child => {
          allProducts.push({
            id: child.key,
            ...child.val()
          });
        });
        renderProducts();
      });
      
      // تفعيل البحث عند الضغط على زر Enter
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchProducts();
        }
      });
      
      // إغلاق البطاقات عند النقر خارجها
      document.addEventListener('click', function(event) {
        if (!aboutCard.contains(event.target) && event.target !== aboutBtn) {
          closeAboutCard();
        }
        if (!contactFormContainer.contains(event.target) && event.target !== contactBtn) {
          closeContactForm();
        }
      });
    });
  </script>
</body>
</html>